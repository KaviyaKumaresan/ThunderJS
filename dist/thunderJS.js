var ThunderJS=function(){"use strict";function l(n){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,o)}return t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=null;"undefined"!=typeof WebSocket?t=WebSocket:"undefined"!=typeof MozWebSocket?t=MozWebSocket:void 0!==n?t=n.WebSocket||n.MozWebSocket:"undefined"!=typeof window?t=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(t=self.WebSocket||self.MozWebSocket);function i(e){if("string"==typeof e)try{e=JSON.parse(e.normalize())}catch(n){}if(!e.id&&e.method){var n=u[e.method];n&&Array.isArray(n)&&n.length&&n.forEach(function(n){n(e.params)})}}function f(t){return new Promise(function(n,e){if(p)n(p);else try{d||((d=new s(function(n){return[n&&n.protocol||"ws://",n&&n.host||"localhost",":"+(n&&n.port||80),n&&n.endpoint||"/jsonrpc"].join("")}(t),"notification")).addEventListener("message",function(n){!function(n){if("string"==typeof n)try{n=JSON.parse(n.normalize())}catch(n){}if(n.id){var e=a[n.id];e?("result"in n?e.resolve(n.result):e.reject(n.error),delete a[n.id]):console.log("no pending request found with id "+n.id)}}(n.data)}),d.addEventListener("message",function(n){i(n.data)}),d.addEventListener("open",function(){i({method:"client.ThunderJS.events.connect"}),n(p=d)}),d.addEventListener("close",function(){i({method:"client.ThunderJS.events.disconnect"}),p=d=null}))}catch(n){e(n)}})}function o(u){return{request:function(i,c,s){return new Promise(function(n,e){var t=h+=1,o=function(n,e,t){var o;return(o=t&&t.version)?o:n&&(n[e]||n.default)||1}(u.versions,i,s),r=function(n,e,t,o,r){o&&delete o.version;var i={jsonrpc:"2.0",id:n,method:[e,r,t].join(".")};return!o&&!1!==o||"object"===l(o)&&0===Object.keys(o).length||(i.params=o),i}(t,i,c,s,o);u.debug&&(console.log(" "),console.log("API REQUEST:"),console.log(JSON.stringify(r,null,2)),console.log(" ")),a[t]={body:r,resolve:n,reject:e},function(n,e){f(n).then(function(n){n.send(JSON.stringify(e))}).catch(console.error)}(u,r)})}}}function r(o){var r=this;return new Promise(function(t,n){c?t(c):r.api.request("Controller","status").then(function(n){var e=n.filter(function(n){return"WebKitBrowser"===n.callsign}).shift().configuration.inspector.split(":").pop();(c=new s("ws://".concat(r.options.host,":").concat(e,"/devtools/page/1"))).on("message",function(n){var e=JSON.parse(n);i({method:[o,g[e.method]].join("."),params:e.params})}),c.on("open",function(){t(c)})}).catch(n)})}var c,s=t,a={},u={},p=null,d=null,h=0,g={"Console.messageAdded":"log","Canvas.canvasMemoryChanged":"canvasChange"},y={DeviceInfo:{freeRam:function(n){return this.call("systeminfo",n).then(function(n){return n.freeram})},version:function(n){return this.call("systeminfo",n).then(function(n){return n.version})}},WebInspector:{register:function(n){r.call(this,n.id).then(function(n){n.send('{"id":1,"method":"Console.enable"}')})},unregister:function(){r.call(this).then(function(n){n.send('{"id":10,"method":"Console.disable"}')})}}};function v(e,t,n){var o=this,r=function(n,e,t){var o=b(n,e);if(!u[o]){u[o]=[];if(n!=="ThunderJS"){var r="register";var i=o.split(".").slice(0,-1).join(".");var c={event:e,id:i};this.call(n,r,c).then().catch()}}return u[o].push(t),u[o].length-1}.call(this,e,t,n);return{dispose:function(){var n=b(e,t);u[n].splice(r,1),0===u[n].length&&function(n,e){var t=b(n,e);if(delete u[t],"ThunderJS"!==n){var o="unregister";var r=t.split(".").slice(0,-1).join(".");var i={event:e,id:r};this.call(n,o,i).then().catch()}}.call(o,e,t)}}}function b(n,e){return["client",n,"events",e].join(".")}var m,j=function t(n){return{options:n,plugin:!1,call:function(){var n=Array.prototype.slice.call(arguments);this.plugin&&n[0]!==this.plugin&&n.unshift(this.plugin);var e=n[0],t=n[1];return"function"==typeof this[e][t]?this[e][t](n[2]):this.api.request.apply(this,n)},registerPlugin:function(n,e){this[n]=w(Object.assign(Object.create(t),e,{plugin:n}))},subscribe:function(){},on:function(){var n=Array.prototype.slice.call(arguments);return-1<n[0].indexOf("connect","disconnect")?n.unshift("ThunderJS"):this.plugin&&n[0]!==this.plugin&&n.unshift(this.plugin),v.apply(this,n)},once:function(){console.log("todo ...")}}},w=function n(e){return new Proxy(e,{get:function(o,r){var i=o[r];return"api"===r?m:void 0!==i?"function"==typeof i?-1<["on","once","subscribe"].indexOf(r)?function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return i.apply(this,e)}:function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(t,n){"object"===l(t)&&("object"!==l(t)||t.then&&"function"==typeof t.then)||(t=new Promise(function(n,e){t instanceof Error==!1?n(t):e(t)}));var e="function"==typeof n[n.length-1]?n[n.length-1]:null;if(!e)return t;t.then(function(n){return e(null,n)}).catch(function(n){return e(n)})}(i.apply(this,e),e)}:"object"===l(i)?n(Object.assign(Object.create(j(o.options)),i,{plugin:r})):i:!1===o.plugin?n(Object.assign(Object.create(j(o.options)),{},{plugin:r})):function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.unshift(r),o.call.apply(this,e)}}})};return function(n){return m=o(n),w(function(r){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(i,!0).forEach(function(n){var e,t,o;e=r,o=i[t=n],t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):e(i).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}({},j(n),{},y))}}();
